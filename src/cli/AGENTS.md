# AGENTS.md - cli

This directory contains the Julep CLI implementation (`julep_cli`).

Key Uses
- Bash commands:
  - cd cli
  - source .venv/bin/activate
  - poe format
  - poe lint
  - poe typecheck
  - poe test
  - poe check
- Core files and utilities:
  - `src/julep_cli/` contains command and subcommand handlers.
- Code style guidelines:
  - Follows root `AGENTS.md` Python standards (FastAPI style not directly relevant).
  - CLI functions and flags use snake_case and kebab-case respectively.
- Testing instructions:
  - Tests in `cli/tests/` using `ward` and `pytest`.
  - Run specific tests: `poe test --search "pattern" --fail-limit 1`.
- Repository etiquette:
  - Version CLI via `julep.yaml` and bump in lockfile.
- Developer environment:
  - Ensure `PYTHONPATH=$PWD` when invoking commands.
- Unexpected behaviors:
  - Autogenerated CLI docs should be manually reviewed in `README.md`.

# Julep CLI Architecture

## Overview
The Julep CLI is a command-line interface tool for interacting with the Julep platform. It enables users to manage agents, tasks, tools, and execute tasks, providing a complete workflow from local development to platform integration.

## Core Components

### Entry Points and Application Structure
- `app.py`: Main application entry point, initializes Typer app and subcommands
- `wrapper.py`: Custom WrappedTyper implementation that provides interactive parameter prompting
- `__main__.py`: Module entry point for direct execution

### Command Modules
- `auth.py`: Authentication with the Julep platform
- `agents.py`: CRUD operations for AI agents
- `tasks.py`: CRUD operations for tasks
- `tools.py`: CRUD operations for agent tools
- `chat.py`: Interactive chat sessions with agents
- `run.py`: Execute defined tasks with inputs
- `executions.py`: Management of task executions
- `logs.py`: Retrieve and display execution logs
- `sync.py`: Synchronize local files with remote platform
- `init.py`: Initialize new projects from templates
- `importt.py`: Import entities from the platform
- `ls.py`: List local project entities

### Models and Utilities
- `models.py`: Pydantic models for CLI state and requests
- `utils.py`: Common utility functions shared across modules

## Key Interfaces

### Project Structure
- `julep.yaml`: Main project configuration file defining agents, tasks, and tools
- `julep-lock.json`: Lock file tracking state between local and remote
- `src/`: Directory structure for storing entity definitions

### Configuration Management
- `~/.config/julep/config.yml`: User configuration with API keys and environment
- `~/.config/julep/julep_state.db`: Persistent SQLite database for CLI state

## Workflow Patterns

### Project Initialization
1. User runs `julep init` with template name
2. CLI downloads template from repository
3. Files are extracted and verified (requires `julep.yaml`)
4. Project structure is displayed with README

### Synchronization System
1. `julep sync` parses local definitions and compares with lock file
2. Local-to-remote: Updates remote platform based on local changes
3. Remote-to-local: Updates local files based on remote changes
4. Supports watch mode for continuous synchronization
5. Conflict resolution with --force-local and --force-remote flags

### Entity Management
1. Create/update local entity definitions in YAML format
2. Reference between entities (agent → tasks, agent → tools) via templated IDs
3. Sync to remote platform with `julep sync`
4. Direct management via CLI commands (`agents create`, `tasks update`, etc.)

### Task Execution Flow
1. Define task in project
2. Run task using `julep run --task <id> --input {...}`
3. Stream execution logs with `julep logs --execution-id <id> --tail`
4. Chat with agents using `julep chat --agent <id>`

## Implementation Patterns

### Interactive CLI Design
- Wrapped Typer app with custom parameter prompting
- Rich console output with progress bars and styled text
- Automatic parameter validation and conversion
- Support for optional JSON input for complex types

### Error Handling
- Consistent error presentation via error_console
- Typed exceptions with meaningful messages
- Progress indicators for long-running operations

### State Management
- SQLite database for persisting CLI state across invocations
- Lock file (julep-lock.json) for tracking remote synchronization
- Environment-aware configuration with local and global settings

### Data Serialization
- YAML for human-editable entity definitions
- JSON for lock files and machine-readable data exchange
- Support for both formats in output (--json flag)

## Client Interactions
- Julep SDK used for all API communication
- Rate limiting and error handling via SDK features
- Authenticated via JWT tokens stored in config
- Environment-aware (production, dev) endpoint selection
